## Codex CLI R 自动化任务指引

### 目录参考
- `ReadMe.md`：项目原始说明，概述自动化目标与能力。
- `agents.md`：执行任务的详细流程（当前文件），根据实际项目需要持续完善。
- 建议在仓库根目录下新增 `tasks/` 保存每个任务的输入、代码与运行产出，便于归档。

### 执行步骤
1. **在仓库根目录整理任务资料**  
   - 创建 `tasks/<任务名>/` 目录，用于集中存放该次自动化的 prompt、数据副本、脚本与日志。  
   - 将本地原始数据或脱敏数据复制到 `tasks/<任务名>/data/` 中，确保 Codex CLI 以及容器可访问。
2. **描述需求并校验输入**  
   - 在 `tasks/<任务名>/prompt.md` 中写明分析目标、数据位置、关键业务约束及期望输出。  
   - 对照 `ReadMe.md` 中的项目目标，确认本次任务适合通过 Codex CLI 自动化执行。
3. **调用 Codex CLI 生成初版脚本**  
   - 于仓库根目录执行 Codex CLI 命令，引用 `prompt.md` 内容及数据路径。  
   - 将生成的 R 脚本保存为 `tasks/<任务名>/script_initial.R`，并记录 CLI 返回的假设、TODO 等提示。
4. **准备并启动容器环境**  
   - 使用既定的容器镜像（或依需求调整 Dockerfile）在仓库根目录启动容器，将 `tasks/<任务名>/` 目录挂载到容器内工作路径。  
   - 在容器中确认 R 版本及依赖满足脚本需要，必要时在 `tasks/<任务名>/setup.R` 中记录安装命令供复用。
5. **迭代执行与调试**  
   - 初次运行 `script_initial.R`，将日志输出重定向到 `tasks/<任务名>/logs/run_01.log`。  
   - 若 Codex CLI 自动修复失败或遇到业务异常，手动更新 `prompt.md` 或脚本，并按序号保留 `script_v02.R`、`run_02.log` 等版本，方便回溯。  
   - 每轮迭代完成后在 `tasks/<任务名>/notes.md` 记录修改原因和剩余问题。
6. **结果复核与交付**  
   - 当脚本稳定运行后，生成最终脚本 `tasks/<任务名>/script_final.R` 和关键输出（图表、表格、模型等）。  
   - 将运行日志、CLI 交互记录及人工复核结论统一保存，更新 `ReadMe.md` 或团队文档同步经验。

### 前置条件
- 已安装并配置 Codex CLI，具备执行容器命令的权限。
- 容器主机能够访问 `tasks/<任务名>/data/` 下的数据文件与必要的网络资源（如需安装依赖）。
- 针对敏感数据需准备脱敏版本或在受限沙箱中运行，以降低泄露风险。

### 注意事项
- Codex CLI 的自动修复不保证业务正确性，重要结论必须由领域专家复核。
- 将大型任务拆分为多个 `tasks/<任务名>/` 子目录分阶段执行，可降低每次迭代的复杂度。
- 若容器中的 R 版本或依赖与任务需求不符，优先在容器启动前统一配置，避免在运行期临时修复。
- 建议将脚本和 `prompt.md` 纳入版本管理，记录每次迭代的改动与原因，方便团队共享与审计。
